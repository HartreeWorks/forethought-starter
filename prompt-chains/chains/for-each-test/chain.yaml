meta:
  id: for-each-test
  name: For-each test
  description: Test chain to verify for_each functionality

inputs: []

steps:
  # Step 1: Generate 3 topics
  - id: generate_topics
    name: Generate topics
    model: claude-sonnet-4
    prompt: prompts/01-generate-topics.md
    output:
      type: json

  # Step 2: Process each topic (using for_each)
  - id: expand_topics
    name: Expand each topic
    model: claude-sonnet-4
    for_each: $steps.generate_topics.output
    parallel: true
    max_concurrency: 3
    prompt: prompts/02-expand-topic.md
    input:
      topic: $item
      index: $index
    output:
      type: json

  # Step 3: Summarise results
  - id: summarise
    name: Summarise all expansions
    model: claude-sonnet-4
    prompt: prompts/03-summarise.md
    input:
      expansions: $steps.expand_topics.output
    output:
      type: prose
